<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Styles -->
  <link href='styles/main.css' rel='stylesheet'>
  <!-- Animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <!-- Font -->
  <link href="https://api.fontshare.com/css?f[]=supreme@200&display=swap" rel="stylesheet">
  <title>New Life Ministries</title>
</head>

<body>
  <!-- Navigation Start -->
  <nav>
    <div class="logo">
      <div class='navwrapper'>
        <!-- <a href='index.html'><img src='images/nlmlogo.png'></a> -->
      </div>
    </div>
    <div class="links-wrapper">
      <ul class="nav-links">
        <li class="nav-link nav-link-white"><a href="index.html">Home</a></li>
        <li class="nav-link nav-link-white"><a href="form.html">Donate</a></li>
        <li class="nav-link nav-link-white"><a href="contact.html">Contact</a></li>
      </ul>
    </div>
    <button class="hamburger hamburger--spring" type="button">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
  </nav>
  <!-- Navigation End -->
  <!-- Main -->
  <main>
    <!-- Landing Start -->
    <section class='standard-landing'>
      <h1>Donate</h1>
      <p><a href='index.html'><span class='home-link'>Home</span></a> / Donate</p>
    </section>
    <!-- Landing End -->
    <section class='products-section'>
      <div class='products-heading'>
        <h2>We offer several ways for our followers to give: </h2>
        <ul>
          <li>Apple and Google Pay</li>
          <li>Easy tithe</li>
          <li>SMS</li>
        </ul>
      </div>
      <section class="products">

      </section>
    </section>
    <!-- FOOTER START -->
    <div class="footer">
      <div class='footer-container'>
        <div class='col'>
          <h2>Contact Us</h2>
          <ul>
            <li>(918) XXX-XXXX</li>
            <li>NewLifeMinistries@info</li>
            <li>Social Media</li>
            <a
              href='https://docs.google.com/forms/d/e/1FAIpQLSe9Uc7CNITsPMgOjlJ44WmHbGdlbd5XdJXSmwLjYMLakWbdJw/viewform?usp=sf_link'>
              <li>Site Feedback</li>
            </a>
          </ul>
        </div>
        <div class='col'>
          <h2>Quick Links</h2>
          <ul>
            <a href='index.html'>
              <li>Home</li>
            </a>
            <a href='form.html'>
              <li>Donate</li>
            </a>
            <a href='contact.html'>
              <li>Contact</li>
            </a>
          </ul>
        </div>
        <div class='col'>
          <h2>New Life Ministries</h2>
          <ul>
            <li>Easy Tithe</li>
            <li>Apple Pay / Google Pay</li>
            <li>Prayer Request</li>
          </ul>
        </div>
        <div class='col'>
          <h2>Social</h2>
          <div class='social-media'>
            <a href='https://www.facebook.com/offeringnewlife'><img src='images/facebook.svg' class='standard-icon'
                alt='facebook icon'></a>
            <a href='https://www.instagram.com/offeringnewlife/'><img src='images/instagram.svg' class='standard-icon'
                alt='insta icon'></a>
          </div>
        </div>
      </div>
      <div class='site-credit'>
        <h3>Developed by <span class='credit'><a href='https://rivaswebsites.com'>Rivas Websites</a></span></h3>
      </div>
    </div>
    <!-- END OF FOOTER -->
  </main>

  <template id="product">
    <div class="product">
      <!-- <img src="" alt="" /> -->
      <h2>name</h2>
      <!-- <p class="description">description</p>
      <p class="price">price</p> -->
      <form action="/.netlify/functions/create-checkout" method="post">
        <!-- <label for="quantity">Quantity</label>
        <input type="number" id="quantity" name="quantity" value="1" min="1" max="10" /> -->
        <input type="hidden" name="sku" value="" />
        <button type="submit">Donate</button>
      </form>
    </div>
  </template>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    function format(amount, currency) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency,
      }).format((amount / 100).toFixed(2));
    }

    async function handleSubmit(event) {
      event.preventDefault();
      document
        .querySelectorAll('button')
        .forEach((button) => (button.disabled = true));

      const form = new FormData(event.target);
      const data = {
        sku: form.get('sku'),
        //quantity: Number(form.get('quantity')),
      };

      const response = await fetch('/.netlify/functions/create-checkout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      }).then((res) => res.json());

      const stripe = Stripe(response.publishableKey);
      const {
        error
      } = await stripe.redirectToCheckout({
        sessionId: response.sessionId,
      });

      if (error) {
        document
          .querySelectorAll('button')
          .forEach((button) => (button.disabled = false));
        console.error(error);
      }
    }

    async function loadProducts() {
      if (!'content' in document.createElement('template')) {
        console.error('Your browser doesnâ€™t support HTML template elements.');
        return;
      }

      const data = await fetch('/.netlify/functions/get-products')
        .then((res) => res.json())
        .catch((err) => console.error(err));

      const products = document.querySelector('.products');
      const template = document.querySelector('#product');

      data.forEach((product) => {
        const container = template.content.cloneNode(true);

        container.querySelector('h2').innerText = product.name;
        // container.querySelector('.description').innerText =
        //   product.description;
        // container.querySelector('.price').innerText = format(
        //   product.amount,
        //   product.currency
        // );
        container.querySelector('[name=sku]').value = product.sku;

        // const img = container.querySelector('img');
        // img.src = product.image;
        // img.alt = product.name;

        const form = container.querySelector('form');
        form.addEventListener('submit', handleSubmit);

        products.appendChild(container);
      });
    }

    loadProducts();
  </script>
  <script src='scripts/scripts.js'></script>
</body>

</html>